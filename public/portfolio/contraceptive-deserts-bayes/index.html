<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Spatial Bayesian Models of Contraceptive Deserts</title>
<meta name="description" content="Raven McKnight&#39;s personal website">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/owl.carousel.css">
<link rel="stylesheet" href="/css/owl.theme.css">


  <link href="/css/style.pink.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="/img/favicon.png">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138632608-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="/">raven mcknight</a></h1>
    
      <p class="sidebar-p">stats! data science! visualization!</p>
    
    <ul class="sidebar-menu">
      
        <li><a href="/portfolio/">Home</a></li>
      
        <li><a href="/about/">About</a></li>
      
        <li><a href="/contact/">Get in touch</a></li>
      
    </ul>
    <p class="social">
  
  
  
  
  
  <a href="mailto:raven.i.mcknight@gmail.com" data-animate-hover="pulse" class="email">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://www.linkedin.com/in/raven-mcknight-0703a5175/" data-animate-hover="pulse" class="external">
    <i class="fa fa-linkedin"></i>
  </a>
  
  
  
  <a href="https://github.com/" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2019 Raven McKnight
        
        | Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="/">raven mcknight</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>Spatial Bayesian Models of Contraceptive Deserts</h1>
         


<div id="common-introduction" class="section level3">
<h3>Common introduction</h3>
</div>
<div id="case-study-contracpetive-deserts" class="section level3">
<h3>Case study: Contracpetive Deserts</h3>
<p>Birth control is a critical aspect of basic health care. Accessible contraceptive services reduce unplanned pregnancies, lower abortion rates, and empower women to navigate the world and their health more freely. Over 20 million women in the United States are in need of publicly-funded birth control – over 1 million of them live in a county without a single provider.</p>
<p>This project was initially inspired by a map from <a href="https://powertodecide.org/what-we-do/access/access-birth-control">Power to Decide</a>. They define a <em>contraceptive desert</em> as an area where a single birth control provider must serve 1000 or more women in need. In this project, I model the ratio of <em>women in need of publicly funded services</em> per <em>clinic providing publicly funded services</em>. This is a naive metric, but I think an intuitive one in beginning to understand birth control accessibility. Admittedly, access is more nuanced than the simple presence of clinics. There are many other factors to consider: physical accessibility, stigma, under-education, or any other number of personal characteristics. Developing a better metric for accessibility is an exciting area for future work!</p>
<div id="the-data" class="section level4">
<h4>The data</h4>
<p>For this project, I use data on birth control patients and providers from the Guttmacher Institute, demographics from the American Community Survey, and TIGER/Line shapefiles for state and county boundaries. We can read the cleaned birth control and demographic data from <a href="https://github.com/ravenmcknight">my Github</a>.</p>
<pre class="r"><code>library(readr)

file &lt;- &quot;https://raw.github.com/ravenmcknight/contraceptive-deserts/master/contraceptive_deserts_may10&quot;   # url for csv 
bc &lt;- read_csv(file)</code></pre>
<p>Now we have data for (almost) every county in the United States! I’ll focus on the following variables:</p>
<table>
<colgroup>
<col width="23%" />
<col width="76%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>variable</strong></th>
<th><strong>meaning</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>WomenPerClinic</td>
<td>Women in need of publicly funded services/publicly funded clinics, Guttmacher 2015</td>
</tr>
<tr class="even">
<td>MedianInc</td>
<td>Median county income, ACS 2015</td>
</tr>
<tr class="odd">
<td>PercHSGrad</td>
<td>Percent of county with high school diploma or equivalent, ACS 2015</td>
</tr>
<tr class="even">
<td>PercPoverty</td>
<td>Percent of county living below poverty line, ACS 2015</td>
</tr>
<tr class="odd">
<td>PercWhite, PercBlack ….</td>
<td>Seven variables recording racial demographics of each county, ACS 2015</td>
</tr>
<tr class="even">
<td>PercRural</td>
<td>Percent of population living in rural area, ACS 2015</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Because we have so much data, I’ll also filter to get <em>just</em> counties in my home state, North Carolina. This will speed up our models and make visualization much easier!</p>
<pre class="r"><code>library(tidyverse)

nc &lt;- bc %&gt;%
  filter(State==&quot;NorthCarolina&quot;)</code></pre>
<p>If we want to visualize this data, we can join it to county shapefiles from the US Census. If you don’t have it already, install the <code>tigris</code> package to get shapefiles without dealing with the census website. I’ll also load the rest of the spatial packages we’ll need here. One thing we need to be aware of when working with spatial data is the difference between <code>sp</code> and <code>sf</code> objects. They are not entirely interchangable, so I’ll name my spatial objects with “sp” of “sf” at the end to keep them straight!</p>
<pre class="r"><code>library(tigris)
library(sp)
library(sf)
library(spdep)
library(ape)

nc_counties_sp &lt;- counties(state=&quot;NC&quot;, cb=TRUE)   # cb = TRUE gives smaller files when possible to speed up mapping

nc_counties_sf &lt;- st_as_sf(nc_counties_sp)

nc &lt;- nc %&gt;%
  mutate(GEOID = as.character(fips))  # Create a field to join on 

nc_sf &lt;- full_join(nc_counties_sf, nc, by=&quot;GEOID&quot;)  # Join!

nc_sp &lt;- as(nc_sf, &quot;Spatial&quot;)  # Go ahead and make an sp for later</code></pre>
<p>Now, we can start mapping! Let’s look at the number of women per clinic across counties in North Carolina.</p>
<pre class="r"><code>library(extrafont) # totally optional step to change default ggplot font!
#font_import()
#loadfonts()

# I can also save my ggplot themes to use throughout!

project_theme_map &lt;- theme(text = element_text(family = &quot;Oswald Light&quot;), panel.grid.major = element_line(&quot;transparent&quot;), axis.text=element_blank(), legend.direction=&quot;horizontal&quot;, legend.position=&quot;bottom&quot;, plot.title = element_text(hjust = 0.5), legend.key.width=unit(.8, &quot;cm&quot;))  

project_theme_plot &lt;- theme(text = element_text(family = &quot;Oswald Light&quot;), legend.direction=&quot;horizontal&quot;, legend.position=&quot;bottom&quot;, plot.title = element_text(hjust = 0.5), legend.key.width=unit(.8, &quot;cm&quot;))  

project_colors &lt;- scale_fill_gradient(low=&quot;#92b6b1&quot;, high=&quot;#666a86&quot;, na.value=&quot;#C0C0C0&quot;, guide=&quot;colorbar&quot;)

ggplot() +
  geom_sf(data=nc_sf, aes(fill=WomenPerClinic), color=NA) +
  labs(title = &quot;Accessibility in North Carolina&quot;) +
  guides(fill=guide_colorbar(title=&quot;Women Per Clinic&quot;)) + 
  theme_minimal() +
  project_colors +
  project_theme_map</code></pre>
<p><img src="/portfolio/contraceptive-deserts-bayes_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>With this map, we can start to identify counties with particularly high patient-to-clinic ratios. My goal in this project is to use spatial Bayesian models to identify clusters of limited access to birth control.</p>
</div>
<div id="spatial-autocorrelation" class="section level4">
<h4>Spatial autocorrelation?</h4>
<p>Before we go on with spatial modeling, we should confirm that our data isn’t spatially random. If it <em>is</em>, then we don’t need to use spatial methods. We can check for spatial autocorrelation using Moran’s I. If Moran’s I is close to 1, we have positive spatial autocorrelation (clustering) and if it’s close to 0, we have negative autocorelation (repulsion).</p>
<p>We can check if our data is spatially random by randomly assigning values to each county in North Carolina 10000 times and taking the Moran’s I of each simulation. Then, we compare our <em>real</em> data to the simulated data. If our data is “less random” than any of our simulations, we can feel confident that we need to use spatial methods.</p>
<pre class="r"><code>set.seed(454)
nc_nb &lt;- poly2nb(nc_sf)   
nc_w &lt;- nb2listw(nc_nb, style=&quot;B&quot;)

moran.mc(na.omit(nc_sp$WomenPerClinic), nc_w, nsim = 9999) # markov chain simulations</code></pre>
<pre><code>## 
##  Monte-Carlo simulation of Moran I
## 
## data:  na.omit(nc_sp$WomenPerClinic) 
## weights: nc_w 
## omitted: 23 
## number of simulations + 1: 10000 
## 
## statistic = 0.13251, observed rank = 9830, p-value = 0.017
## alternative hypothesis: greater</code></pre>
<p>This test tells us that our real data is not <em>the least</em> random, but it is less random than about 98% of the simulations with slight positive spatial autocorrelation. My guess is that we would see stronger spatial autocorrelation if we looked at the entire country, or at North Carolina by census tract. Either way, Moran’s I confirms that we should be using spatial methods!</p>
</div>
<div id="a-familiar-model-variable-selection" class="section level4">
<h4>A Familiar Model &amp; Variable Selection</h4>
<p>Before trying to identify clusters of limited access, I decided to fit a model with more familiar interpretations. By fitting the CAR model proposed in 2000 by Leroux, we can get coefficients on each of our predictors to get a sense of how they are related to access. First, we can check out the distribution of our predictors and their relationship with women per clinic.</p>
<pre class="r"><code>predictors &lt;- na.omit(as.data.frame(nc)) %&gt;%
  dplyr::select(WomenPerClinic, MedianInc, PercHSGrad, PercPoverty, PercWhite, PercRural)

titles &lt;- c(
                    `MedianInc` = &quot;Median Income&quot;,
                    `PercHSGrad` = &quot;Percent High School Graduates&quot;, 
                    `PercPoverty` = &quot;Percent in Poverty&quot;, 
                    `PercRural` = &quot;Percent Rural&quot;, 
                    `PercWhite` = &quot;Percent White&quot;,
                    `WomenPerClinic` = &quot;Women Per Clinic&quot;
                    )

predictors %&gt;%
  gather(key=&quot;var&quot;, value = &quot;value&quot;) %&gt;%
  ggplot(aes(x=value)) + 
    geom_density(fill=&quot;#788aa3&quot;, color=&quot;#788aa3&quot;) +
    facet_wrap(~var, scales= &quot;free&quot;, labeller = as_labeller(titles)) +
    theme_minimal() +
    project_theme_plot</code></pre>
<p><img src="/portfolio/contraceptive-deserts-bayes_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>predictors %&gt;%
  gather(-WomenPerClinic, key = &quot;var&quot;, value = &quot;value&quot;) %&gt;%
  ggplot(aes(x = value, y = WomenPerClinic)) +
    geom_point(color=&quot;#b2c9ab&quot;) +
    facet_wrap(~ var, scales = &quot;free&quot;, labeller = as_labeller(titles)) +
    theme_minimal() +
    project_theme_plot </code></pre>
<p><img src="/portfolio/contraceptive-deserts-bayes_files/figure-html/unnamed-chunk-6-2.png" width="672" /></p>
<p>To better understand these relationships, I’ll fit a Leroux model using each of these five predictors so we can see which are most “important.” For more information on models like this, you can check out <strong>Katie’s post here</strong>. She fits BYM models which are the precursor to Leroux! I chose to use Leroux rather than BYM because its R implementation is more suited to continuous or Gaussian response variables (vignette, page 4-5). The Leroux model is essentially an extension of the BYM model – it’s main advantage is that it handles <em>overdispersion</em> with a specific parameter. Overdispersion occurs when there is more variability in the data than we expect for a given model or data structure. This can occur fairly frequently with “real-world” spatial data, so Leroux offers an advantage in many cases.</p>
<p>We’ll need the CARBayes package to implement our CAR models. This package includes seven main functions, each of which corresponds to a different model with different priors and model structures. For more technical explanation of the entire package, check out the <a href="https://cran.r-project.org/web/packages/CARBayes/vignettes/CARBayes.pdf">vignette</a>.</p>
<p>The last thing we need to start fitting models is a <em>neighborhood structure</em>. This model uses a queen neighborhood structure. This means that any two counties that share a single point of contact are considered neighbors.</p>
<pre class="r"><code>library(CARBayes)</code></pre>
<pre><code>## Loading required package: MASS</code></pre>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre class="r"><code>formula &lt;- WomenPerClinic ~ MedianInc + PercHSGrad + PercPoverty + PercRural + PercWhite   # Our model formula

nc_sp_mod &lt;- nc_sp[which(!is.na(nc_sp$WomenPerClinic)), ] # remove county with na values
nc_sp_mod &lt;- nc_sp[which(!is.na(nc_sp$PercWhite)), ] # and missing demographic data

W.nb &lt;- poly2nb(nc_sp_mod, row.names=rownames(nc_sp_mod), queen=TRUE)   # Create neighborhood matrix
W.list &lt;- nb2listw(W.nb, style=&quot;B&quot;)
W &lt;- nb2mat(W.nb, style=&quot;B&quot;) 

nc_leroux &lt;- S.CARleroux(formula=formula, data=nc_sp_mod, family=&quot;gaussian&quot;, W=W, burnin=100000, n.sample=300000, thin=20)</code></pre>
<pre class="r"><code>print(nc_leroux)</code></pre>
<pre><code>## 
## #################
## #### Model fitted
## #################
## Likelihood model - Gaussian (identity link function) 
## Random effects model - Leroux CAR
## Regression equation - WomenPerClinic ~ MedianInc + PercHSGrad + PercPoverty + PercRural + 
##     PercWhite
## Number of missing observations - 0
## 
## ############
## #### Results
## ############
## Posterior quantities and DIC
## 
##                   Median         2.5%        97.5% n.sample % accept
## (Intercept)     132.5324   -6599.3201    6593.8865    10000    100.0
## MedianInc         0.0234      -0.0268       0.0753    10000    100.0
## PercHSGrad       27.0955     -46.2517     101.6598    10000    100.0
## PercPoverty    3064.4048   -5158.4356   11152.3430    10000    100.0
## PercRural     -3539.5574   -4623.7193   -2421.5266    10000    100.0
## PercWhite         2.5267     -14.0681      18.6112    10000    100.0
## nu2         1936665.1544 1450453.9280 2691808.3242    10000    100.0
## tau2              0.0080       0.0021       0.0820    10000    100.0
## rho               0.4040       0.0312       0.8978    10000     45.5
##             n.effective Geweke.diag
## (Intercept)     10000.0         0.5
## MedianInc        9305.2         0.2
## PercHSGrad      10000.0        -0.1
## PercPoverty     10000.0        -1.3
## PercRural       10000.0         0.7
## PercWhite        9592.5        -1.2
## nu2             10000.0         0.8
## tau2             1629.5        -1.6
## rho              4553.6        -0.2
## 
## DIC =  1704.544       p.d =  5.202246       LMPL =  -852.95</code></pre>
<p>The good news: we have coefficients! The bad news: the 95% coverage interval of almost coefficient includes zero. This means that we can’t confidently conlude that percent of high school graduates has a positive correlation with women per clinic (for example). Ignoring the significance of the predictors for a moment, the quick takeaways from this model are</p>
<ul>
<li>Median income, percent high school graduates, percent living in poverty, and percent white are correlated with <em>higher</em> ratios of women per clinic – ie, worse access to birth control.</li>
<li>Percent rural is the only predictor correlated with lower ratios, and the only predictor whose coverage interval does not include zero. This seems significant but is primarily because very rural counties don’t have enough women in need to count as a desert by our metric! This reveals the major weakness of this analysis.</li>
</ul>
<p>It may be more informative to fit a model without percent rural:</p>
<pre class="r"><code>formula_2 &lt;- WomenPerClinic ~ MedianInc + PercHSGrad + PercPoverty + PercWhite

nc_leroux_2 &lt;- S.CARleroux(formula=formula_2, data=nc_sp_mod, family=&quot;gaussian&quot;, W=W, burnin=100000, n.sample=300000, thin=20)</code></pre>
<pre class="r"><code>print(nc_leroux_2)</code></pre>
<pre><code>## 
## #################
## #### Model fitted
## #################
## Likelihood model - Gaussian (identity link function) 
## Random effects model - Leroux CAR
## Regression equation - WomenPerClinic ~ MedianInc + PercHSGrad + PercPoverty + PercWhite
## Number of missing observations - 0
## 
## ############
## #### Results
## ############
## Posterior quantities and DIC
## 
##                   Median         2.5%        97.5% n.sample % accept
## (Intercept)   -8133.5920  -14820.3965   -1096.9128    10000    100.0
## MedianInc         0.0573       0.0030       0.1106    10000    100.0
## PercHSGrad       87.7827       8.4786     165.6264    10000    100.0
## PercPoverty    4187.0305   -4832.3271   13335.2989    10000    100.0
## PercWhite        -7.5970     -26.9682      11.6411    10000    100.0
## nu2         3074280.2537 2284255.1114 4284214.6324    10000    100.0
## tau2              0.0082       0.0021       0.0912    10000    100.0
## rho               0.3983       0.0277       0.8935    10000     45.5
##             n.effective Geweke.diag
## (Intercept)     10000.0         0.8
## MedianInc       10150.6        -0.2
## PercHSGrad      10000.0         0.0
## PercPoverty     10696.1        -0.7
## PercWhite       10000.0        -2.7
## nu2             10000.0         0.2
## tau2             1144.8        -0.9
## rho              4518.3         1.5
## 
## DIC =  1748.574       p.d =  4.086743       LMPL =  -874.79</code></pre>
<p>This is more like it! The coverage intervals for percent in poverty and percent white still cross zero, but the coefficients make a bit more sense:</p>
<ul>
<li>Median income and percent high school graduates are positively correlated with women per clinic, likely because education and income tend to be concentrated in more populous, urban areas</li>
<li>Poverty is positively correlated with women per clinic</li>
<li>Higher percentages of white residents are <em>negatively</em> correlated with women per clinic – ie, white areas have better access to birth control. This is a result I expected to see!</li>
</ul>
<p>With all of this in mind, we’re ready to start identifying clusters!</p>
</div>
<div id="boundary-detection" class="section level4">
<h4>Boundary Detection</h4>
<p>To answer my intial question – can we identify clusters of limited access to birth control – I’ll use the boundary detection CAR model proposed by Lee and Mitchell in 2012. This model uses a <em>dissimilarity metric</em> to identify spatial breaks in our data.</p>
</div>
</div>

         <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ravenmcknight" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.cookie.js"> </script>
<script src="/js/ekko-lightbox.js"></script>
<script src="/js/jquery.scrollTo.min.js"></script>
<script src="/js/masonry.pkgd.min.js"></script>
<script src="/js/imagesloaded.pkgd.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/front.js"></script>



</body>
</html>
